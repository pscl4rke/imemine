#!/usr/bin/python3


import configparser
import subprocess
import sys


BIN_DIR = "/home/psc/bin"


class Entry:

    def __init__(self, name):
        self.name = name

    def venv_dir(self):
        return "/home/psc/.pip2bin/%s" % self.name


class Pip2bin:

    def run(self):
        config = configparser.ConfigParser()
        config.read([sys.argv[1]])
        for section in config.sections():
            entry = Entry(section)
            venv_dir = entry.venv_dir()
            subprocess.run(["/usr/bin/python3", "-m", "venv", venv_dir], check=True)
            subprocess.run(["%s/bin/pip" % venv_dir, "install", section], check=True)
            subprocess.run(["ln", "-s", "%s/bin/%s" % (venv_dir, section),
                            "%s/." % BIN_DIR], check=True)


if __name__ == '__main__':
    Pip2bin().run()
