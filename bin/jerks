#!/usr/bin/python2
#======================================================================#
# JERKS EMAIL VIEWER                             (c) 2014 P. S. Clarke #
#======================================================================#

# Some people are incapable of sending emails with readable plain
# text.  Machine-generated newsletters are the worst offenders.

import sys
import email
import quopri
import subprocess

if __name__ == '__main__':
    msg = email.message_from_string(sys.stdin.read())
    for part in msg.walk():
        if part.get_content_type() == 'text/html':
            html = part.get_payload()
            if part.get('Content-Transfer-Encoding', '') == 'base64':
                html = html.decode('base64')
            html = quopri.decodestring(html) # Quoted-Printable using '='
            html = html.replace("://", "---") # Break tracker links
            args = ("w3m", "-T", "text/html")
            browser = subprocess.Popen(args, stdin=subprocess.PIPE)
            browser.communicate(html)

