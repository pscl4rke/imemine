#!/usr/bin/python
#======================================================================#
# SHIFT-AUDIO AV SYNC FIXER                      (c) 2017 P. S. Clarke #
#======================================================================#


import subprocess
import sys
import time


class Shifter:

    ffmpeg = "/usr/bin/ffmpeg"

    def shift_args(self):
        return [
            "-af", "atrim=0.2",
        ]

    def args(self, srcpath, destpath):
        args = [
            self.ffmpeg,
            "-fflags", "genpts",
            "-i", srcpath,
            "-c:v", "copy",
        ]
        args.extend(self.shift_args())
        args.append(destpath)
        return args

    def main(self):
        start = time.time()
        srcpath, destpath = sys.argv[1], sys.argv[2]
        exitcode = subprocess.call(self.args(srcpath, destpath))
        duration = time.time() - start
        print "That took %i:%02i with exit code %i" % (duration / 60, duration % 60, exitcode)


if __name__ == '__main__':
    Shifter().main()
