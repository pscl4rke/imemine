#!/usr/bin/python3

import subprocess
import sys

#WIDTH = "148mm"  # a5
#HEIGHT = "210mm"  # a5
WIDTH = "149mm"  # 6x4 photo
HEIGHT = "100mm"  # 6x4 photo

# the default res is 75, opts found with `scanimage -A`
#print("Warning: this is pretty low-res")
RESOLUTION = 300  # 6x4 inch PNM is about 6MB
#RESOLUTION = 1200  # 6x4 inch PNM is about 100MB

class Scanner:

    def main(self):

        if len(sys.argv) < 2:
            sys.stderr.write("Missing destination PNM file\n")
            sys.exit(1)
        dest = sys.argv[1]

        # could use sys.argv here to alter the above settings

        with open(dest, "wb") as outfile:
            subprocess.check_call([
                "scanimage",
                "--progress",
                "--resolution", str(RESOLUTION),
                "--mode", "Color",
                "-x", WIDTH,
                "-y", HEIGHT,
            ], stdout=outfile)

        # Missing \n after progress meter
        sys.stderr.write("\n")

        # could scan to /tmp/xxxx.pnm and then use `convert` to make $dest

if __name__ == '__main__':
    Scanner().main()
