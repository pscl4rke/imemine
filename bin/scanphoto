#!/usr/bin/python3

import subprocess
import sys

#WIDTH = "148mm"  # a5
#HEIGHT = "210mm"  # a5
WIDTH = "149mm"  # 6x4 photo
HEIGHT = "100mm"  # 6x4 photo

# the default res is 75, opts found with `scanimage -A`
#print("Warning: this is pretty low-res")
RESOLUTION = 300  # 6x4 inch PNM is about 6MB
#RESOLUTION = 1200  # 6x4 inch PNM is about 100MB

class Scanner:

    def main(self):

        if len(sys.argv) < 2:
            sys.stderr.write("Missing destination base filename (no .ext needed)\n")
            sys.exit(1)
        base_name = sys.argv[1]
        pnm_file = "%s.pnm" % base_name
        jpg_file = "%s.jpg" % base_name

        # could use sys.argv here to alter the above settings

        with open(pnm_file, "wb") as outfile:
            subprocess.check_call([
                "scanimage",
                "--progress",
                "--resolution", str(RESOLUTION),
                "--mode", "Color",
                "-x", WIDTH,
                "-y", HEIGHT,
            ], stdout=outfile)

        # Missing \n after progress meter
        sys.stderr.write("\n")

        subprocess.check_call([
            "convert",
            pnm_file,
            jpg_file,
        ])

if __name__ == '__main__':
    Scanner().main()
