#!/bin/bash

makefile=$(realpath "$1")

function setUp {
    tmpdir=$(mktemp -d -t tmpmake."$(basename "$makefile")".XXXXXXX)
    echo "From $makefile" 1>&2
    ln -s "$makefile" "$tmpdir/Makefile"
    echo "Using $tmpdir" 1>&2
    cd "$tmpdir"
}

function tearDown {
    echo "Tearing down $tmpdir" 1>&2
    cd /
    rm -r "$tmpdir"
}

setUp
trap tearDown EXIT
${SHELL-/bin/bash}
