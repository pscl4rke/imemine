#!/usr/bin/python3
#======================================================================#
# REFLOW PARAGRAPHS FOR WORDPRESS                (c) 2015 P. S. Clarke #
#======================================================================#


# FIXME: doesn't reflow block quotes properly
# FIXME: leaves a space on the end of paragraphs


import sys


def flowform(line):
    if line.strip().startswith("%"): # comment
        return ""
    if line.strip() == "": # blank
        return "\n\n"
    if line[0] in "\n\t\r >":
        return line
    if line[0] == '[' and ']:' in line: # or '](' not in line
        return line
    return line.replace('\n', ' ')


def wpflow(src):
    chunks = []
    for line in src.splitlines():
        chunks.append(flowform(line + "\n"))
        chunks.append("")
    return "".join(chunks)


if __name__ == '__main__':
    sys.stdout.write(wpflow(sys.stdin.read()))
